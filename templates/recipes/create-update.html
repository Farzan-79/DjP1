{% extends 'base.html' %}

{% block content %}

<style>
    .hidden {
        display: none;
    }
    .ingredient-form {
        border-bottom: 1px solid black;
        margin: 5px;
    }
</style>

{% if update and object.user != request.user %}
    <h1>This is not your article to edit</h1>
    <a href="{% url 'recipes:list' %}">back to articles</a>
{% elif create or update and request.user == object.user %}

    {% if create %}
        <h1 style="color: blueviolet;">Create a new Recipe</h1>
    {% elif update %}
        <h1 style="color: blueviolet;">Edit your Recipe</h1>
    {% endif %}

    {% if not message %}
        <div style="margin-top: 50px;">
            {% include 'recipes/partials/forms.html' %}
        </div>
    {% else %}
        <h4>{{ message }}</h4>
        <a href="{{ object.get_absolute_urls }}">{{ object.name }}</a><br>
        <a href="{% url 'recipes:list' %}">Back to Recipes</a>
    {% endif %}
{% endif %}

<script>
    const addMoreBtn = document.getElementById('add-more')
    const totalNewForms = document.getElementById('id_form-TOTAL_FORMS')

    addMoreBtn.addEventListener('click', add_new_form)
    function add_new_form(event) {
        if (event) {
            event.preventDefault()
        }
        const currentIngredientForms = document.getElementsByClassName('ingredient-form')
        let currentFormsCount = currentIngredientForms.length // + 1
        // console.log(currentFormsCount) 

        const ingredientForms = document.getElementById('ingredient-forms')
        const copyEmptyFormEl = document.getElementById('empty-form').cloneNode(true)
        copyEmptyFormEl.setAttribute('class', 'ingredient-form')
        copyEmptyFormEl.setAttribute('id', `form-${currentFormsCount}`)
        const regex = new RegExp('__prefix__', 'g')
        copyEmptyFormEl.innerHTML = copyEmptyFormEl.innerHTML.replace(regex, currentFormsCount)
        totalNewForms.setAttribute('value', currentFormsCount + 1)
        ingredientForms.append(copyEmptyFormEl)
    }
</script>

{% endblock %}